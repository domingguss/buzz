package  {		import flash.display.Sprite;	import flash.events.Event;    import flash.events.KeyboardEvent;    import flash.ui.Keyboard;    import flash.display.SimpleButton;    import flash.events.MouseEvent;    import flash.display.StageDisplayState;    import flash.display.MovieClip;    import com.greensock.TweenMax;    import flash.display.Stage;    import flash.desktop.NativeProcessStartupInfo;    import flash.filesystem.File;    import flash.desktop.NativeProcess;    import flash.utils.Timer;    import flash.events.TimerEvent;		public class Main extends Sprite     {		const teamViewWidth:Number = 750;		const teamViewHeight:Number = 100;		        private var _keys:Object = { };        private var _teamViews:Array = [];				public var team1: MovieClip;		public var team2: MovieClip;		public var team3: MovieClip;		public var team4: MovieClip;				private var process: NativeProcess;				private var keepAliveTimer: Timer;		private var lightUpAllLEDs: Boolean = false;				        public function Main():void         {            if (stage) init();            else addEventListener(Event.ADDED_TO_STAGE, init);        }        private function init(e:Event = null):void         {            removeEventListener(Event.ADDED_TO_STAGE, init);            stage.addEventListener(KeyboardEvent.KEY_DOWN, onKeyDown);            stage.addEventListener(KeyboardEvent.KEY_UP, onKeyUp);            stage.addEventListener(Event.ENTER_FRAME, onEnterFrame);						stage.displayState = StageDisplayState.FULL_SCREEN_INTERACTIVE;						// send status to wbuzz every 30 seconds to keep alive the controllers			keepAliveTimer = new Timer(30000, 0);			keepAliveTimer.addEventListener(TimerEvent.TIMER, keepAliveTimerTickHandler);			keepAliveTimer.start();						reset();        }				private function keepAliveTimerTickHandler (e:TimerEvent):void{			trace("keep alive");			sendStatus();		}		private function onKeyDown(e:KeyboardEvent):void         {            _keys[e.keyCode] = true;						if (e.keyCode == Keyboard.ENTER) {				setLEDStatus("all");			}        }        private function onKeyUp(e:KeyboardEvent):void         {            _keys[e.keyCode] = false; 						if (e.keyCode == Keyboard.ENTER) {				sendStatus();			}        }        private function onEnterFrame(e:Event):void         {            if (_keys[Keyboard.SPACE]) {				reset();			}                        if (_keys[Keyboard.A] || _keys[Keyboard.B] || _keys[Keyboard.C] || _keys[Keyboard.D] || _keys[Keyboard.E]) {                present(team1);            }						if (_keys[Keyboard.F] || _keys[Keyboard.G] || _keys[Keyboard.H] || _keys[Keyboard.I] || _keys[Keyboard.J]) {                present(team2);            }						if (_keys[Keyboard.K] || _keys[Keyboard.L] || _keys[Keyboard.M] || _keys[Keyboard.N] || _keys[Keyboard.O]) {                present(team3);            }						if (_keys[Keyboard.P] || _keys[Keyboard.Q] || _keys[Keyboard.R] || _keys[Keyboard.S] || _keys[Keyboard.T]) {                present(team4);            }        }				private function reset(): void {			var desiredWidth:Number = stage.width / 4;			var desiredHeight:Number = (teamViewHeight * desiredWidth) / teamViewWidth;						var y:Number = (1100 - desiredHeight) / 2;			TweenMax.to(team1, 0.3, {x:desiredWidth * 0, y:y, width:desiredWidth, height:desiredHeight});			TweenMax.to(team2, 0.3, {x:desiredWidth * 1, y:y, width:desiredWidth, height:desiredHeight});			TweenMax.to(team3, 0.3, {x:desiredWidth * 2, y:y, width:desiredWidth, height:desiredHeight});			TweenMax.to(team4, 0.3, {x:desiredWidth * 3, y:y, width:desiredWidth, height:desiredHeight});						_teamViews = []			sendStatus();		}				private function present(teamView: MovieClip): void {			if (_teamViews.indexOf(teamView) >= 0) {				// already presented				return; 			}						var x:Number = (stage.width - teamViewWidth) / 2;			var y:Number = (stage.height / 4 * _teamViews.length) + ((stage.height / 4) - teamViewHeight) / 2;			TweenMax.to(teamView, 0.2, {x:x, y:y, width: teamViewWidth, height: teamViewHeight});						_teamViews.push(teamView);						if (_teamViews.length >= 1) {				sendStatus();			}		}						// -------------- send state to Buzz Controllers ---------------						private function sendStatus(): void {						if (_teamViews.length >= 1) {				var teamView = _teamViews[0];				switch (teamView) {					case team1:						setLEDStatus("1");						break;					case team2:						setLEDStatus("2");						break;					case team3:						setLEDStatus("3");						break;					case team4:						setLEDStatus("4");						break;				}			} else if (_teamViews.length == 0) {				setLEDStatus("0");			}		}						private function setLEDStatus(status: String): void {			var nativeProcessStartupInfo = new NativeProcessStartupInfo() 			var file = File.applicationDirectory.resolvePath("buzz"); 			nativeProcessStartupInfo.executable = file; 			var processArgs = new Vector.<String>();			processArgs[0] = status; 			nativeProcessStartupInfo.workingDirectory = File.documentsDirectory; 			nativeProcessStartupInfo.arguments = processArgs; 			process = new NativeProcess()			process.start(nativeProcessStartupInfo); 		}    }}